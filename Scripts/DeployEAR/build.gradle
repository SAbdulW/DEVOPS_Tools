version = currentVersion
group = groupId
project.ext.set("archivesBaseName", "${EARName}");

/* Artifactory configuration - BEGIN - Generated by Gradle - Gradle Build Scripts tool*/
buildscript {
	repositories {
		maven {
			url "${artifactory_contextUrl}/plugins-release"
			credentials {
				username = "${artifactory_user}"
				password = "${artifactory_password}"
			}
		}
	}
	dependencies {
		classpath(group: 'org.jfrog.buildinfo', name: 'build-info-extractor-gradle', version: '2.2.4')
		classpath 'org.batcha.gradle.plugins:git-dependencies:0.2'
	}
}

apply plugin: 'maven'
apply plugin: 'java'

if (env.equals('dev')) {
	apply plugin: 'artifactory'
}

repositories {
	//Resolving the artifact from the release repo, the one promoted by team
	maven {
		url "${artifactory_contextUrl}/ci-release"
		credentials {
			username = "${artifactory_user}"
			password = "${artifactory_password}"
		}
	}
}

dependencies {
	compile(group: 'com.verint.iserver.frameworkintegrationserver.components', name: 'Framework Integration Server', version: "${fisVersion}")
}

def wfoEAR = file("${EARName}.ear")

artifacts {
	archives file: wfoEAR, name: "${EARName}", type: 'ear'
}

if (env.equals('dev')) {
	artifactory {
		publish {
			contextUrl = "${artifactory_contextUrl}"	// The base Artifactory URL if not overridden by the publisher/resolver
			repository {
				repoKey = "${publishRepo}"
				username = "${artifactory_user}"
				password = "${artifactory_password}"
				maven = true
			}
		}
		resolve {
			contextUrl = "${artifactory_contextUrl}"	// The base Artifactory URL if not overridden by the publisher/resolver
			repository {
				repoKey = 'repo'
				username = "${artifactory_user}"
				password = "${artifactory_password}"
				maven = true
			}
			repository {
				repoKey = 'plugins-release'
				username = "${artifactory_user}"
				password = "${artifactory_password}"
				maven = true
			}
		}
	}
}

task updatePOM() {
	doLast {
		ant.replace(file: "${projectDir}/build/poms/pom-default.xml", token: "Framework Integration Server", value: "FrameworkIntegrationServer")
		//ant.replaceregexp (file: "${projectDir}/build/poms/pom-default.xml", match: "Framework Integration Server", replace:"FrameworkIntegrationServer", byline:"true")
	}
}